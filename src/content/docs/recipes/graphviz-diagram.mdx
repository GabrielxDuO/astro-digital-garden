---
title: Graphviz diagram
tags: [component, diagram]
---

import Graphviz from "@components/Graphviz.astro";

<Graphviz
  src={`digraph finite_state_machine {
  bgcolor="transparent";
	fontname="Helvetica,Arial,sans-serif";
	node [fontname="Helvetica,Arial,sans-serif"]
	edge [fontname="Helvetica,Arial,sans-serif"]
	rankdir=LR;
	node [shape = doublecircle]; 0 3 4 8;
	node [shape = circle];
	0 -> 2 [label = "SS(B)"];
	0 -> 1 [label = "SS(S)"];
	1 -> 3 [label = "S($end)"];
	2 -> 6 [label = "SS(b)"];
	2 -> 5 [label = "SS(a)"];
	2 -> 4 [label = "S(A)"];
	5 -> 7 [label = "S(b)"];
	5 -> 5 [label = "S(a)"];
	6 -> 6 [label = "S(b)"];
	6 -> 5 [label = "S(a)"];
	7 -> 8 [label = "S(b)"];
	7 -> 5 [label = "S(a)"];
	8 -> 6 [label = "S(b)"];
	8 -> 5 [label = "S(a)"];
}`}
/>

Example taken [here](https://graphviz.org/Gallery/directed/fsm.html)

## About

[Graphviz](https://graphviz.org/) is open source graph visualization software. On the one hand it is general diagraming tool, so it doesn't have DSL to directly express specific diagrams (let's say Hasse diagram or ER diagram). On the other hand if you don't have better solution you can always bend Graphviz to desired diagram (though it can be tedious sometimes).

## Instalation

```bash title="Instal dependenciesâ€¦"
pnpm add @hpcc-js/wasm
```

```astro
// src/components/Graphviz.astro
---
import { Graphviz as GraphvizWasm } from "@hpcc-js/wasm/graphviz";
const graphviz = await GraphvizWasm.load();

interface Props {
  src: string;
}

const src = Astro.props.src; // await Astro.slots.render('default');

let svg = graphviz
  .dot(src)
  .replace(`<?xml version="1.0" encoding="UTF-8" standalone="no"?>`, "")
  .replace(
    `<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">`,
    ""
  );

const widthMatch = svg.match(/width="(\d+)([^"]+)"/);
if (widthMatch) svg = svg.replace(widthMatch[0], "");

const heightMatch = svg.match(/height="(\d+)([^"]+)"/);
if (heightMatch) svg = svg.replace(heightMatch[0], "");

// TODO: remove html comments
---

<div class="graphviz">
  <Fragment set:html={svg} />
</div>
```

### Dark mode

Basic dark mode can be implemented with:

```css
.graphviz {
  text {
    fill: var(--sl-color-white);
  }
  [fill="black"] {
    fill: var(--sl-color-white);
  }
  [stroke="black"] {
    stroke: var(--sl-color-white);
  }
}
```

Plus you can pass [`class`](https://graphviz.org/docs/attrs/class/) to Edges and Nodes to implement **advanced dark mode**.

### Tips

- To remove background use `bgcolor="transparent"`

## Example

```mdx
<Graphviz src={`digraph x {bgcolor="transparent";rankdir=LR;node [shape=box]
  Start -> Stop}`} />
```

<Graphviz src={`digraph x {bgcolor="transparent";rankdir=LR;node [shape=box]
  Start -> Stop}`} />

Compare it to [[mermaid-diagrams-in-markdown#example|similar example in Mermaid]]